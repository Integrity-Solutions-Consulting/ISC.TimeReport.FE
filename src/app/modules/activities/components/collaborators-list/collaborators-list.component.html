<div class="main-class">
  <div class="top-container">
    <!-- Left-aligned search field -->
    <mat-form-field appearance="outline" class="search-field">
      <input matInput
            (keyup)="applyFilter($event)"
            placeholder="Buscar por nombres, número de identificación..."
            [formControl]="searchControl"
            #input>
      <mat-icon matSuffix>search</mat-icon>
    </mat-form-field>

    <!-- Right-aligned controls -->
    <div class="right-controls">
      <!-- Download button above datepicker -->
      <button mat-flat-button class="download-button">
        <mat-icon>download</mat-icon>
        Descargar
      </button>

      <!-- Date Range Picker -->
      <mat-form-field class="date-picker" appearance="outline">
        <mat-date-range-input [formGroup]="range" [rangePicker]="picker">
          <input matStartDate formControlName="start" placeholder="Fecha inicio">
          <input matEndDate formControlName="end" placeholder="Fecha fin">
        </mat-date-range-input>
        <mat-hint>DD/MM/YYYY – DD/MM/YYYY</mat-hint>
        <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
        <mat-date-range-picker #picker></mat-date-range-picker>

        @if (range.controls.start.hasError('matStartDateInvalid')) {
          <mat-error>Fecha inicio inválida</mat-error>
        }
        @if (range.controls.end.hasError('matEndDateInvalid')) {
          <mat-error>Fecha fin inválida</mat-error>
        }
      </mat-form-field>
    </div>
  </div>

  <table mat-table [dataSource]="dataSource" matSort class="collaborator-table">
    <!-- Checkbox Column -->
    <ng-container matColumnDef="select">
      <th mat-header-cell *matHeaderCellDef>
        <mat-checkbox (change)="$event ? masterToggle() : null"
                      [checked]="selection.hasValue() && isAllSelected()"
                      [indeterminate]="selection.hasValue() && !isAllSelected()">
        </mat-checkbox>
      </th>
      <td mat-cell *matCellDef="let row">
        <mat-checkbox (click)="$event.stopPropagation()"
                      (change)="$event ? selection.toggle(row) : null"
                      [checked]="selection.isSelected(row)">
        </mat-checkbox>
      </td>
    </ng-container>

    <!-- Name Column -->
    <ng-container matColumnDef="colaborador">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Colaborador</th>
      <td mat-cell *matCellDef="let element">
        <strong>{{element.nombre}}</strong>
      </td>
    </ng-container>

    <!-- Project Column -->
    <ng-container matColumnDef="proyecto">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Proyecto</th>
      <td mat-cell *matCellDef="let element">{{element.proyecto}}</td>
    </ng-container>

    <!-- Client Column -->
    <ng-container matColumnDef="cliente">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Cliente</th>
      <td mat-cell *matCellDef="let element">{{element.cliente}}</td>
    </ng-container>

    <!-- Leader Column -->
    <ng-container matColumnDef="lider">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Lider Técnico</th>
      <td mat-cell *matCellDef="let element">{{element.lider}}</td>
    </ng-container>

    <!-- Hours Column -->
    <ng-container matColumnDef="horas">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Nro de Horas</th>
      <td mat-cell *matCellDef="let element">{{element.horas}}</td>
    </ng-container>

    <!-- Status Column -->
    <ng-container matColumnDef="estado">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Estado</th>
      <td mat-cell *matCellDef="let element">
        <div class="status-container" [ngClass]="{
          'completed': element.estado === 'Completo',
          'pending': element.estado === 'Pendiente'
        }">
          <div class="status-dot"></div>
          <div class="status-text">{{element.estado}}</div>
        </div>
      </td>
    </ng-container>

    <!-- Actions Column -->
    <ng-container matColumnDef="actions">
      <th mat-header-cell *matHeaderCellDef>Acciones</th>
      <td mat-cell *matCellDef="let element">
        <button mat-icon-button class="download-button" matTooltip="Descargar">
          <mat-icon aria-hidden="false" aria-label="Download icon">download</mat-icon>
        </button>
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
  </table>

  <mat-paginator
    [length]="totalItems"
    [pageSize]="pageSize"
    [pageSizeOptions]="[5, 10, 25, 100]"
    (page)="onPageChange($event)"
    aria-label="Seleccionar página de colaboradores">
  </mat-paginator>
</div>
