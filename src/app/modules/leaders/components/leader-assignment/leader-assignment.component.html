<!-- leader-assignments-dialog.component.html -->
<h2 mat-dialog-title>
  Asignaciones de Proyectos - {{leader?.person?.firstName}} {{leader?.person?.lastName}}
</h2>
<mat-dialog-content>
  <div class="dialog-content">
    <!-- Información del líder -->
    <div class="leader-info" *ngIf="leader">
      <div class="info-row">
        <div class="info-item">
          <strong>Identificación:</strong>
          {{leader.person.identificationNumber}}
        </div>
        <div class="info-item">
          <strong>Email:</strong> {{leader.person.email}}
        </div>
      </div>
      <div class="info-row">
        <div class="info-item">
          <strong>Teléfono:</strong> {{leader.person.phone}}
        </div>
        <div class="info-item">
          <strong>Estado:</strong>
          <span [class.active]="leader.status" [class.inactive]="!leader.status">
            {{leader.status ? 'Activo' : 'Inactivo'}}
          </span>
        </div>
      </div>
    </div>

    <div class="loading-spinner" *ngIf="loading">
      <mat-spinner diameter="40"></mat-spinner>
      <p>Cargando asignaciones...</p>
    </div>

    <div *ngIf="!loading && dataSource.data.length === 0" class="no-data">
      <mat-icon>assignment</mat-icon>
      <p>No se encontraron asignaciones de proyectos para este líder</p>
      <button mat-raised-button color="primary" (click)="addAssignment()">
        <mat-icon>add</mat-icon>
        Agregar primera asignación
      </button>
    </div>

    <div *ngIf="!loading && dataSource.data.length > 0" class="assignments-container">
      <div class="table-header">
        <h3>Proyectos Asignados ({{dataSource.data.length}})</h3>
        <button mat-raised-button color="primary" (click)="addAssignment()">
          <mat-icon>add</mat-icon>
          Nueva Asignación
        </button>
      </div>

      <table mat-table [dataSource]="dataSource" class="assignments-table">
        <!-- Columna Proyecto -->
        <ng-container matColumnDef="project">
          <th mat-header-cell *matHeaderCellDef> Proyecto </th>
          <td mat-cell *matCellDef="let assignment">
            <div class="project-info">
              <div class="project-name">{{assignment.projectName}}</div>
              <div *ngIf="!assignment.projectName.includes('no encontrado')" class="project-id">
                ID: {{assignment.id}}
              </div>
            </div>
          </td>
        </ng-container>

        <!-- Columna Responsabilidad -->
        <ng-container matColumnDef="responsibility">
          <th mat-header-cell *matHeaderCellDef> Responsabilidad </th>
          <td mat-cell *matCellDef="let assignment">{{assignment.responsibility}}</td>
        </ng-container>

        <!-- Columna Fecha Inicio -->
        <ng-container matColumnDef="startDate">
          <th mat-header-cell *matHeaderCellDef> Inicio </th>
          <td mat-cell *matCellDef="let assignment">{{formatDate(assignment.startDate)}}</td>
        </ng-container>

        <!-- Columna Fecha Fin -->
        <ng-container matColumnDef="endDate">
          <th mat-header-cell *matHeaderCellDef> Fin </th>
          <td mat-cell *matCellDef="let assignment">{{formatDate(assignment.endDate)}}</td>
        </ng-container>

        <!-- Columna Tipo de Liderazgo -->
        <ng-container matColumnDef="leadershipType">
          <th mat-header-cell *matHeaderCellDef> Tipo </th>
          <td mat-cell *matCellDef="let assignment">
            <span [class.integrity]="assignment.leadershipType" [class.external]="!assignment.leadershipType">
              {{getLeadershipTypeName(assignment.leadershipType)}}
            </span>
          </td>
        </ng-container>

        <!-- Columna Estado -->
        <ng-container matColumnDef="status">
          <th mat-header-cell *matHeaderCellDef> Estado </th>
          <td mat-cell *matCellDef="let assignment">
            <span [class.active]="assignment.status" [class.inactive]="!assignment.status">
              {{getStatusName(assignment.status)}}
            </span>
          </td>
        </ng-container>

        <!-- Columna Acciones -->
        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef> Acciones </th>
          <td mat-cell *matCellDef="let assignment">
            <button mat-icon-button (click)="editAssignment(assignment)" title="Editar">
              <mat-icon>edit</mat-icon>
            </button>
            <button mat-icon-button (click)="deleteAssignment(assignment)" title="Eliminar">
              <mat-icon>delete</mat-icon>
            </button>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
      </table>
    </div>
  </div>
</mat-dialog-content>
<mat-dialog-actions align="end">
  <button mat-button (click)="onClose()">Cerrar</button>
</mat-dialog-actions>
