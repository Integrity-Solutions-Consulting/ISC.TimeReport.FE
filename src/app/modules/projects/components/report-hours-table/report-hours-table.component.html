<div class="filter-card">
  <div class="filter-row">
    <!-- CLIENTE AUTOCOMPLETE -->
    <mat-form-field appearance="outline" class="filter-item filter-client">
      <input
        matInput
        placeholder="Buscar Cliente.."
        [formControl]="clientFilter"
        [matAutocomplete]="autoClient"
        #clientInput
      />
      <mat-icon matSuffix>search</mat-icon>
      <mat-autocomplete #autoClient="matAutocomplete" hideSingleSelectionIndicator>
        <mat-option *ngFor="let c of filteredClients" [value]="c">
          <mat-icon class="option-icon">business</mat-icon>
          {{ c }}
        </mat-option>
      </mat-autocomplete>
    </mat-form-field>

    <!-- AÑO -->
    <mat-form-field appearance="outline" class="filter-item filter-year">
      <mat-select [formControl]="yearFilter" placeholder="Año">
        <mat-option *ngFor="let y of years" [value]="y">{{ y }}</mat-option>
      </mat-select>
    </mat-form-field>

    <!-- MES -->
    <mat-form-field appearance="outline" class="filter-item filter-month">
      <mat-select [formControl]="monthFilter" placeholder="Mes">
        <mat-option *ngFor="let m of months" [value]="m.value">{{
          m.label
        }}</mat-option>
      </mat-select>
    </mat-form-field>

    <!-- BOTONES -->
    <div class="export-btn-wrapper">
      <button mat-flat-button color="primary" (click)="exportToExcel()">
        <mat-icon>download</mat-icon> Exportar
      </button>

      <button
        mat-button
        color="primary"
        class="clear-btn"
        (click)="clearFilters()"
      >
        <mat-icon>filter_alt_off</mat-icon> Limpiar filtros
      </button>
    </div>
  </div>
</div>

<div class="table-wrapper">
  <div class="table-loading-overlay" *ngIf="loading">
    <mat-spinner diameter="60"></mat-spinner>
    <p>Cargando datos...</p>
  </div>

  <table
    mat-table
    [dataSource]="dataSource"
    class="mat-elevation-z2 full-table"
  >
    <ng-container matColumnDef="client">
      <th mat-header-cell *matHeaderCellDef>Cliente</th>
      <td mat-cell *matCellDef="let row">{{ row.client }}</td>
    </ng-container>

    <ng-container matColumnDef="year">
      <th mat-header-cell *matHeaderCellDef>Año</th>
      <td mat-cell *matCellDef="let row">{{ row.year }}</td>
    </ng-container>

    <ng-container matColumnDef="month">
      <th mat-header-cell *matHeaderCellDef>Mes</th>
      <td mat-cell *matCellDef="let row">{{ row.monthLabel }}</td>
    </ng-container>

    <ng-container matColumnDef="resources">
      <th mat-header-cell *matHeaderCellDef>Recursos</th>
      <td mat-cell *matCellDef="let row">{{ row.resources }}</td>
    </ng-container>

    <ng-container matColumnDef="totalHours">
      <th mat-header-cell *matHeaderCellDef>Horas</th>
      <td mat-cell *matCellDef="let row">{{ row.totalHours }}</td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
  </table>

  <mat-paginator
    [pageSize]="10"
    [pageSizeOptions]="[5, 10, 20, 50]"
    showFirstLastButtons
  ></mat-paginator>
</div>
